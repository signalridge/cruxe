# Cruxe Default Configuration

[index]
# Maximum file size to index (bytes)
max_file_size = 1_048_576  # 1MB
# Default result limit
default_limit = 10
# Languages to enable for symbol extraction
languages = ["rust", "typescript", "python", "go"]

[storage]
# Base data directory (~ expands to home)
data_dir = "~/.cruxe"
# SQLite busy timeout (ms)
busy_timeout_ms = 5000
# SQLite cache size (negative = KB)
cache_size = -64000  # 64MB

[search]
# Default ref for search queries
default_ref = "main"
# Default freshness policy: "strict", "balanced", "best_effort"
freshness_policy = "balanced"
# Ranking explainability payload level: "off", "basic", "full"
ranking_explain_level = "off"
# Hard payload safety budget for query tool responses (bytes)
max_response_bytes = 65536

[search.intent]
# Intent strategy rule order. Supported values:
# "error_pattern", "path", "quoted_error", "symbol", "natural_language"
# Env override: CRUXE_SEARCH_INTENT_RULE_ORDER (CSV)
rule_order = ["error_pattern", "path", "quoted_error", "symbol", "natural_language"]
# Substring patterns matched for Error intent.
# Env override: CRUXE_SEARCH_INTENT_ERROR_PATTERNS (CSV)
error_patterns = ["error:", "Error:", "panic:", "FATAL", "exception", "Exception", "traceback", "at line", "thread '"]
# File suffixes treated as path-like (case-insensitive).
# Env override: CRUXE_SEARCH_INTENT_PATH_EXTENSIONS (CSV)
path_extensions = [".rs", ".ts", ".tsx", ".js", ".jsx", ".py", ".go", ".java", ".c", ".h", ".cpp", ".rb", ".swift"]
# Two-word symbol query prefixes, e.g. "fn validate_token".
# Env override: CRUXE_SEARCH_INTENT_SYMBOL_KIND_KEYWORDS (CSV)
symbol_kind_keywords = ["fn", "func", "function", "struct", "class", "enum", "trait", "interface", "type", "const", "method"]
# Whether wrapped quotes like "connection refused" / `panic text` imply Error intent.
# Env override: CRUXE_SEARCH_INTENT_ENABLE_WRAPPED_QUOTED_ERROR_LITERAL (bool)
enable_wrapped_quoted_error_literal = true

[search.semantic]
# Semantic mode:
# - off: lexical-only
# - rerank_only: lexical + optional rerank providers, no vector branch
# - hybrid: lexical + vector hybrid path (future extension)
mode = "off"
# Max semantic contribution cap (runtime can reduce this, including to 0.0)
ratio = 0.3
# Skip semantic branch when lexical confidence is already high
lexical_short_circuit_threshold = 0.85
# Low-confidence decision threshold for search metadata
confidence_threshold = 0.5
# Profile advisor mode: "off" | "suggest"
profile_advisor_mode = "off"
# Outbound-provider safety gates (secure by default)
external_provider_enabled = false
allow_code_payload_to_external = false

[search.semantic.embedding]
# Embedding profile: "fast_local" | "code_quality" | "high_quality" | "external"
profile = "fast_local"
# Embedding provider: "local" | "voyage" | "openai"
provider = "local"
model = "NomicEmbedTextV15Q"
model_version = "fastembed-1"
dimensions = 768
batch_size = 32
# Vector storage backend: "sqlite" (brute-force, <50k vectors) | "lancedb" (ANN, requires feature flag)
vector_backend = "sqlite"

[search.semantic.rerank]
# Rerank provider: "none" | "cohere" | "voyage"
provider = "none"
timeout_ms = 5000

[search.semantic.overrides.natural_language]
ratio = 0.5

[search.semantic.overrides.symbol]
ratio = 0.0

[search.semantic.overrides.path]
ratio = 0.0

[search.semantic.overrides.error]
ratio = 0.0

[search.policy]
# Retrieval policy mode:
# - strict: fail closed when policy config is invalid/unavailable
# - balanced: enforce policy, fail open with warnings on non-fatal issues (default)
# - off: bypass policy filtering/redaction
# - audit_only: report blocked/redacted counters without mutating payloads
mode = "balanced"
# Allow per-request policy override (search_code/get_code_context `policy_mode`)
allow_request_override = false
# Allowed override modes when allow_request_override=true
allowed_override_modes = ["balanced", "off", "audit_only"]

[search.policy.path]
# Deny/allow glob patterns applied to result path before emission.
# Example: deny = ["**/secrets/**", "**/.env*"]
deny = []
allow = []

[search.policy.kind]
# Optional allow/deny lists for result/symbol types.
# result types: symbol | snippet | file
deny_result_types = []
allow_result_types = []
deny_symbol_kinds = []
allow_symbol_kinds = []

[search.policy.redaction]
# Built-in seeded detectors are derived from curated secret families:
# - gitleaks-compatible key/token families (aws_access_key_id, github_token, slack_token)
# - private key material (pem_private_key)
# - cloud credential metadata (gcp_service_account)
enabled = true
email_masking = true
# Generic high-entropy detector guardrails
high_entropy_min_length = 20
high_entropy_threshold = 3.5

[search.policy.detect_secrets]
# detect-secrets plugin compatibility mappings:
# - aws -> aws_access_key_id / detect_secrets_aws
# - github -> github_token / detect_secrets_github
# - slack -> slack_token / detect_secrets_slack
# - private_key -> pem_private_key / detect_secrets_private_key
enabled = false
plugins = []
custom_patterns = []

[search.policy.opa]
# Optional prototype hook: if enabled, Cruxe shells out to OPA for allow/deny.
enabled = false
command = "opa"
query = "data.cruxe.allow"
policy_path = ""

[logging]
# Default log level: error, warn, info, debug, trace
level = "info"

[debug]
# Legacy compatibility only. Prefer [search].ranking_explain_level.
ranking_reasons = false
